---
const defaultSrcAnimation =
  "https://lottie.host/0a7b6d62-c679-4ef6-941f-5046d50ea262/Fr7PVw3OyD.lottie"; // Animación por defecto (dark)
---

<!-- Script para Lottie -->
<script
  src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
  type="module"></script>

<!-- Player de Lottie -->
<dotlottie-player
  id="lottie-player"
  src={defaultSrcAnimation}
  background="transparent"
  speed="1"
  class="lg:w-[400px] lg:h-[400px]"
  style="opacity: 1; transition: opacity 0.5s ease;"
  loop
  autoplay
>
</dotlottie-player>

<!--Funciones relacionadas -->
<script>
  //ruta tema dark
  const darkSrc =
    "https://lottie.host/0a7b6d62-c679-4ef6-941f-5046d50ea262/Fr7PVw3OyD.lottie";
  //ruta tema light
  const lightSrc =
    "https://lottie.host/55da5350-bbba-495e-9377-1efc2993c11f/E2l6sfmnkA.lottie";

  //Obtenemos el player de Lottie
  const lottiePlayer = document.getElementById(
    "lottie-player"
  ) as HTMLElement & { load: (src: string) => void };

  // Función para cambiar la animación con fade
  async function updateLottieAnimation() {
    const theme = localStorage.getItem("theme") || "dark";

    // Fade Out
    lottiePlayer.style.opacity = "0";

    // Esperar que termine el fade out (300ms)
    await new Promise((resolve) => setTimeout(resolve, 300));

    // Cambiar la animación según el tema
    if (theme === "dark") {
      lottiePlayer.load(darkSrc);
    } else {
      lottiePlayer.load(lightSrc);
    }

    // Esperar un poquito a que cargue
    await new Promise((resolve) => setTimeout(resolve, 100));

    // Fade In
    lottiePlayer.style.opacity = "1";
  }

  //Inicializamos función para cambiar animación.
  updateLottieAnimation();

  //Si el tema cambia, inicializamos la función para cambiar de animación, denuevo
  const themeToggle = document.getElementById("theme-toggle");
  if (themeToggle) {
    themeToggle.addEventListener("change", () => {
      updateLottieAnimation();
    });
  }
</script>
